<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>蘭州國中第三次段考時程顯示</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700;900&family=Roboto+Mono:wght@500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #0f172a; /* Slate 900 */
            color: #f8fafc; /* Slate 50 */
            overflow: hidden; /* 防止捲動條出現 */
        }
        
        .clock-font {
            font-family: 'Roboto Mono', monospace;
        }

        /* 自訂捲軸樣式 */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #1e293b; 
        }
        ::-webkit-scrollbar-thumb {
            background: #475569; 
            border-radius: 4px;
        }

        /* --- 高亮樣式設計 (Final Design) --- */
        .active-period {
            background-color: #334155; /* Slate 700: 比背景稍亮，維持深色風格 */
            border: 8px solid #eab308; /* Yellow 500: 邊框加粗 */
            transform: scale(1.02);    /* 微微放大 */
            box-shadow: 0 0 30px rgba(234, 179, 8, 0.25); /* 淡淡的黃色光暈 */
            z-index: 10;
        }

        /* 高亮時，時間與科目維持極致白，確保對比度 */
        .active-period .period-time, 
        .active-period .period-subject {
            color: #ffffff; 
            font-weight: 900;
        }
        
        /* 高亮時，節次名稱 (如"第二節") 轉為黃色以呼應邊框 */
        .active-period .period-name {
            color: #facc15; /* Yellow 400 */
        }

        /* 高亮時，顯示的狀態標籤 */
        .active-period .status-badge {
            background-color: #eab308;
            color: #000000;
        }

        /* 彈出視窗背景模糊 */
        .modal-backdrop {
            background-color: rgba(0, 0, 0, 0.75);
            backdrop-filter: blur(4px);
        }
    </style>
</head>
<body class="h-screen w-screen flex flex-col">

    <!-- Header -->
    <header class="h-[8vh] bg-slate-800 flex items-center justify-between px-8 border-b border-slate-700 shadow-lg shrink-0">
        <h1 class="text-3xl font-bold tracking-wider text-blue-400">蘭州國中第三次段考時程表</h1>
        <div class="flex space-x-4 items-center">
            <button onclick="openSettings()" class="px-4 py-2 rounded-lg bg-slate-600 hover:bg-slate-500 text-slate-200 font-bold border border-slate-500 flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="8.5" cy="7" r="4"></circle><line x1="20" y1="8" x2="20" y2="14"></line><line x1="23" y1="11" x2="17" y2="11"></line></svg>
                設定人數
            </button>
            <div class="w-px h-8 bg-slate-600 mx-2"></div>
            <button onclick="setDay(1)" id="btn-day1" class="px-6 py-2 rounded-lg text-xl font-bold transition-colors duration-200">1/15 (Thu.)</button>
            <button onclick="setDay(2)" id="btn-day2" class="px-6 py-2 rounded-lg text-xl font-bold transition-colors duration-200">1/16 (Fri.)</button>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-1 flex overflow-hidden">
        
        <!-- Left Side: Schedule (65% width) -->
        <section class="w-[65%] h-full bg-slate-900 border-r border-slate-700 flex flex-col relative">
            <div class="flex-1 overflow-y-auto p-4 space-y-4" id="schedule-container">
                <!-- Schedule items will be injected here via JS -->
            </div>
            
            <!-- 底部提示 -->
            <div class="h-[6vh] bg-slate-800 flex items-center justify-center border-t border-slate-700 shrink-0">
                <p class="text-slate-400 text-lg">請同學遵守考場規則，保持安靜。</p>
            </div>
        </section>

        <!-- Right Side: Clock (35% width) -->
        <section class="w-[35%] h-full bg-black flex flex-col items-center justify-center relative py-8">
            <!-- Current Date -->
            <div class="text-4xl text-slate-400 mb-2 font-bold" id="clock-date">
                Loading...
            </div>
            
            <!-- Big Time -->
            <div class="flex items-baseline clock-font text-white leading-none">
                <span id="clock-hours" class="text-[12rem] font-bold">00</span>
                <span class="text-[8rem] px-2 animate-pulse text-slate-500">:</span>
                <span id="clock-minutes" class="text-[12rem] font-bold">00</span>
            </div>
            
            <!-- Seconds (Smaller) -->
            <div class="mt-2 mb-8">
                <span id="clock-seconds" class="clock-font text-[6rem] text-yellow-500 font-bold">00</span>
            </div>

            <!-- Current Status Label (已縮小以騰出空間) -->
            <div class="mb-8 px-6 py-2 bg-slate-800 rounded-full border border-slate-700">
                <span class="text-xl text-blue-300 font-bold tracking-widest">現在時刻 Current Time</span>
            </div>

            <!-- Attendance Display (New) -->
            <div class="w-[85%] bg-slate-900/50 rounded-2xl border border-slate-800 p-6 flex justify-around items-center backdrop-blur-sm">
                <div class="flex flex-col items-center">
                    <span class="text-slate-400 text-2xl font-bold mb-2 tracking-widest">應到人數</span>
                    <span id="display-expected" class="text-7xl text-blue-400 font-mono font-bold tracking-tight">0</span>
                </div>
                <div class="w-px h-24 bg-slate-700"></div>
                <div class="flex flex-col items-center">
                    <span class="text-slate-400 text-2xl font-bold mb-2 tracking-widest">實到人數</span>
                    <span id="display-actual" class="text-7xl text-green-400 font-mono font-bold tracking-tight">0</span>
                </div>
            </div>
        </section>

    </main>

    <!-- Attendance Settings Modal -->
    <div id="settings-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center modal-backdrop">
        <div class="bg-slate-800 rounded-2xl shadow-2xl border border-slate-600 w-[400px] p-8 transform transition-all scale-100">
            <h2 class="text-2xl font-bold text-white mb-6 flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-blue-400"><path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="8.5" cy="7" r="4"></circle><line x1="20" y1="8" x2="20" y2="14"></line><line x1="23" y1="11" x2="17" y2="11"></line></svg>
                設定考場人數
            </h2>
            
            <div class="space-y-6">
                <div>
                    <label class="block text-slate-400 text-lg font-bold mb-2">應到人數 (Expected)</label>
                    <input type="number" id="input-expected" class="w-full bg-slate-900 border border-slate-600 rounded-lg px-4 py-3 text-2xl text-white font-mono focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500" placeholder="0">
                </div>
                
                <div>
                    <label class="block text-slate-400 text-lg font-bold mb-2">實到人數 (Actual)</label>
                    <input type="number" id="input-actual" class="w-full bg-slate-900 border border-slate-600 rounded-lg px-4 py-3 text-2xl text-white font-mono focus:outline-none focus:border-green-500 focus:ring-1 focus:ring-green-500" placeholder="0">
                </div>
            </div>

            <div class="flex justify-end gap-3 mt-8">
                <button onclick="closeSettings()" class="px-6 py-2 rounded-lg bg-slate-700 text-slate-300 hover:bg-slate-600 font-bold transition-colors">取消</button>
                <button onclick="saveSettings()" class="px-6 py-2 rounded-lg bg-blue-600 text-white hover:bg-blue-500 font-bold shadow-lg transition-colors">儲存設定</button>
            </div>
        </div>
    </div>

    <script>
        // --- 1. 資料設定 (Configuration) ---
        const schedules = {
            1: [ // 1/15 Thursday
                { name: "第一節", time: "08:30-09:15", start: "08:30", end: "09:15", subject: "自 習" },
                { name: "第二節", time: "09:25-10:10", start: "09:25", end: "10:10", subject: "數學 04" },
                { name: "第三節", time: "10:20-11:05", start: "10:20", end: "11:05", subject: "自 習" },
                { name: "第四節", time: "11:15-12:00", start: "11:15", end: "12:00", subject: "英語 02" },
                { name: "第五節", time: "13:15-14:05", start: "13:15", end: "14:05", subject: "作 文" },
                { name: "第六節", time: "14:20-15:05", start: "14:20", end: "15:05", subject: "自 習" },
                { name: "第七節", time: "15:15-16:00", start: "15:15", end: "16:00", subject: "理化 12" }
            ],
            2: [ // 1/16 Friday
                { name: "第一節", time: "08:30-09:00", start: "08:30", end: "09:00", subject: "自 習" },
                { name: "第二節", time: "09:00-10:10", start: "09:00", end: "10:10", subject: "公民06 / 歷史08 / 地理09" },
                { name: "第三節", time: "10:20-11:05", start: "10:20", end: "11:05", subject: "自 習" },
                { name: "第四節", time: "11:15-12:00", start: "11:15", end: "12:00", subject: "國文 01" }
            ]
        };

        let currentDayIdx = 1;
        
        // --- 2. DOM 元素 ---
        const container = document.getElementById('schedule-container');
        const btnDay1 = document.getElementById('btn-day1');
        const btnDay2 = document.getElementById('btn-day2');
        const elDate = document.getElementById('clock-date');
        const elHours = document.getElementById('clock-hours');
        const elMinutes = document.getElementById('clock-minutes');
        const elSeconds = document.getElementById('clock-seconds');
        
        // Modal Elements
        const modal = document.getElementById('settings-modal');
        const inputExpected = document.getElementById('input-expected');
        const inputActual = document.getElementById('input-actual');
        const displayExpected = document.getElementById('display-expected');
        const displayActual = document.getElementById('display-actual');

        // --- 3. 初始化 (Initialization) ---
        function init() {
            // 自動偵測日期以選擇預設頁籤
            const now = new Date();
            const month = now.getMonth() + 1;
            const date = now.getDate();
            
            if (month === 1 && date === 16) {
                currentDayIdx = 2;
            } else {
                currentDayIdx = 1;
            }

            // 載入儲存的人數設定
            loadAttendanceSettings();

            renderSchedule();
            updateClock();
            
            // 啟動定時器
            setInterval(updateClock, 1000);       // 每秒更新時鐘
            setInterval(checkActiveStatus, 1000); // 每秒檢查考試狀態
        }

        // --- 4. 切換日期功能 ---
        window.setDay = function(dayIndex) {
            currentDayIdx = dayIndex;
            renderSchedule();
            checkActiveStatus(); 
        };

        // --- 5. 渲染行程表 ---
        function renderSchedule() {
            if (currentDayIdx === 1) {
                btnDay1.className = "px-6 py-2 rounded-lg text-xl font-bold bg-blue-600 text-white shadow-lg scale-105";
                btnDay2.className = "px-6 py-2 rounded-lg text-xl font-bold bg-slate-700 text-slate-400 hover:bg-slate-600";
            } else {
                btnDay1.className = "px-6 py-2 rounded-lg text-xl font-bold bg-slate-700 text-slate-400 hover:bg-slate-600";
                btnDay2.className = "px-6 py-2 rounded-lg text-xl font-bold bg-blue-600 text-white shadow-lg scale-105";
            }

            const data = schedules[currentDayIdx];
            let html = '';
            
            data.forEach((item, index) => {
                // Determine font size based on subject length - INCREASED SIZES
                // subjectFontSize: For short subjects (<10 chars) uses text-7xl or text-8xl
                //                  For long subjects uses text-5xl
                const subjectFontSize = item.subject.length > 10 ? 'text-5xl' : 'text-8xl';
                
                html += `
                <div id="period-${index}" class="period-row flex items-center p-4 bg-slate-800 rounded-xl border border-slate-700 transition-all duration-300">
                    <!-- Period & Time - Adjusted Width to 35% for Larger Text -->
                    <div class="w-[38%] flex flex-col justify-center border-r border-slate-600 pr-2">
                        <span class="period-name text-4xl text-slate-400 font-bold mb-1">${item.name}</span>
                        <span class="period-time text-6xl text-white font-mono tracking-tight leading-none">${item.time}</span>
                    </div>
                    
                    <!-- Subject - Adjusted Width to 62% and Increased Font Sizes -->
                    <div class="w-[62%] pl-6 flex items-center justify-between">
                        <span class="period-subject ${subjectFontSize} font-bold text-slate-100 tracking-tight leading-none">${item.subject}</span>
                        <span class="status-badge hidden px-4 py-2 rounded-lg text-xl font-bold uppercase tracking-widest ml-4 whitespace-nowrap">進行中 NOW</span>
                    </div>
                </div>
                `;
            });
            container.innerHTML = html;
        }

        // --- 6. 更新時鐘 ---
        function updateClock() {
            const now = new Date();
            const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            const dateStr = `${now.getMonth() + 1}/${now.getDate()} (${days[now.getDay()]})`;
            elDate.innerText = dateStr;

            const h = String(now.getHours()).padStart(2, '0');
            const m = String(now.getMinutes()).padStart(2, '0');
            const s = String(now.getSeconds()).padStart(2, '0');

            elHours.innerText = h;
            elMinutes.innerText = m;
            elSeconds.innerText = s;
        }

        // --- 7. 檢查並高亮 (修改版：只檢查時間，不檢查日期) ---
        function checkActiveStatus() {
            const now = new Date();
            const currentMinutes = now.getHours() * 60 + now.getMinutes();
            
            // ** 移除日期限制 **
            // 讓使用者只要切換到該 Tab，時間到了就高亮，方便模擬確認
            const isSimulatingExam = true; 

            const data = schedules[currentDayIdx];

            data.forEach((item, index) => {
                const row = document.getElementById(`period-${index}`);
                if (!row) return;

                const [startH, startM] = item.start.split(':').map(Number);
                const startTotal = startH * 60 + startM;

                const [endH, endM] = item.end.split(':').map(Number);
                const endTotal = endH * 60 + endM;

                // 只要時間符合就高亮
                if (isSimulatingExam && currentMinutes >= startTotal && currentMinutes < endTotal) {
                    
                    if (!row.classList.contains('active-period')) {
                        document.querySelectorAll('.period-row').forEach(r => {
                            r.classList.remove('active-period');
                            r.classList.add('bg-slate-800');
                            r.querySelector('.status-badge').classList.add('hidden');
                        });
                        
                        row.classList.remove('bg-slate-800');
                        row.classList.add('active-period');
                        row.querySelector('.status-badge').classList.remove('hidden');
                        row.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }
                } else {
                     if (row.classList.contains('active-period')) {
                        row.classList.remove('active-period');
                        row.classList.add('bg-slate-800');
                        row.querySelector('.status-badge').classList.add('hidden');
                     }
                }
            });
        }

        // --- 8. 人數設定相關功能 ---
        
        window.openSettings = function() {
            // 開啟時將目前顯示的值填入 input
            inputExpected.value = displayExpected.innerText;
            inputActual.value = displayActual.innerText;
            modal.classList.remove('hidden');
        };

        window.closeSettings = function() {
            modal.classList.add('hidden');
        };

        window.saveSettings = function() {
            const expected = inputExpected.value || '0';
            const actual = inputActual.value || '0';

            displayExpected.innerText = expected;
            displayActual.innerText = actual;

            // 儲存到 localStorage 以便刷新後保留
            localStorage.setItem('exam_expected_count', expected);
            localStorage.setItem('exam_actual_count', actual);

            closeSettings();
        };

        function loadAttendanceSettings() {
            const savedExpected = localStorage.getItem('exam_expected_count');
            const savedActual = localStorage.getItem('exam_actual_count');

            if (savedExpected) displayExpected.innerText = savedExpected;
            if (savedActual) displayActual.innerText = savedActual;
        }

        // 啟動程式
        init();

    </script>
</body>
</html>